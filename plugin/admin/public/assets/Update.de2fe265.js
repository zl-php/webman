var _=(c,b,n)=>new Promise((g,p)=>{var d=a=>{try{m(n.next(a))}catch(v){p(v)}},r=a=>{try{m(n.throw(a))}catch(v){p(v)}},m=a=>a.done?g(a.value):Promise.resolve(a.value).then(d,r);m((n=n.apply(c,b)).next())});import{B as G}from"./BasicForm.67047978.js";import{B as x,a as j}from"./index.e8ce4467.js";import{aG as q,r as l,a as J,aI as C,o as W,aJ as z,p as H,i as K,j as L,b5 as Q,x as X}from"./index.656c725e.js";import{u as M,t as Y}from"./tree.3e2d93c2.js";import{a as E,b as O}from"./common.6ce55d48.js";import"./index.1f507897.js";import"./index.ddc16f9d.js";import"./_baseIteratee.d7866646.js";import"./index.4f3dd38a.js";import"./index.6e6030d1.js";import"./index.d60da1cd.js";import"./index.28987d30.js";import"./index.2e5a1dae.js";import"./index.873c27ee.js";import"./index.38230a24.js";import"./uniqBy.73b96c75.js";import"./download.add46730.js";import"./index.2c103eba.js";import"./useWindowSizeFn.2783558b.js";import"./FullscreenOutlined.52703f8e.js";const A=l(null),T=l(""),k=l(""),D=l(""),P=l(""),Z=J({components:{BasicForm:G,BasicModal:x},emits:["reload","register"],setup(c,{emit:b}){const n=l("\u6DFB\u52A0\u8BB0\u5F55"),g=l(""),p=l(""),d=l(""),r=l("insert"),m=[],[a,{closeModal:v}]=j(e=>_(this,null,function*(){p.value=e.column,d.value=e.value,g.value=e.table,T.value=e.selectUrl,k.value=e.insertUrl,D.value=e.updateUrl,P.value=e.schemaUrl,p.value?(r.value="edit",n.value="\u7F16\u8F91\u8BB0\u5F55"):(r.value="insert",n.value="\u63D2\u5165\u8BB0\u5F55");const o=yield E(P.value),i=o.forms,B=o.columns,u={};for(let t of B)u[t.field]=t;const f=A.value;if(!f)return;yield f.resetSchema([]);const s={};s[p.value]=d.value;const w=r.value=="edit"?yield E(T.value,s):{},F=r.value=="edit"&&w.items.length?w.items[0]:{};for(let t of i){if(!t.form_show)continue;let h=r.value=="edit"?F[t.field]:u[t.field].default,[R,U,y]=N(t,h);t.field=="password"&&(y="",r.value=="edit"&&(U={placeholder:"\u4E0D\u66F4\u65B0\u5BC6\u7801\u8BF7\u7559\u7A7A"})),f.appendSchemaByField({field:t.field,component:R,label:t.comment||t.field,colProps:{span:24},required:r.value=="edit"&&t.field=="password"?!1:!u[t.field].nullable,componentProps:U,defaultValue:y},"")}})),{createMessage:$}=X(),{success:I}=$;function N(e,o){o=S(o);let i={disabled:r.value=="edit"?!1:e.readonly};if(e.control=="Switch"&&(o=!!o),e.control=="DatePicker"&&(i.showTime=!0),(e.control=="ApiTreeSelect"||e.control=="ApiTree")&&(i.resultField="list",o&&i.multiple&&typeof o!="number"&&(o=o.split(","))),e.control_args)for(let B of e.control_args.split(";")){let u=B.indexOf(":");if(u==-1)continue;let f=B.substring(0,u).trim(),s=B.substring(u+1).trim();if(e.control=="Upload"&&f==="url"){i.api=M(s);continue}if((e.control=="ApiTreeSelect"||e.control=="ApiTree")&&f==="url"){i.api=Y(s);continue}if(u=s.indexOf(":"),u!==-1){let w=s.split(",");s=[];for(let F of w){let[t,h]=F.split(":");s.push({value:t,label:h})}}i[f]=S(s)}return e.control=="Upload"&&(o?(o=o.split(","),i.value=o):i.value=[],i.api||(i.api=M())),[e.control,i,o]}function S(e){return e==="true"?!0:e==="false"?!1:String(Number(e))===e?Number(e):e}return{formElRef:A,handleSubmit:()=>_(this,null,function*(){try{const e=A.value;if(!e)return;const o=yield e.validate();r.value=="edit"?yield O(D.value,{column:p.value,value:d.value,data:o}):yield O(k.value,{data:o}),v(),I("\u64CD\u4F5C\u6210\u529F"),b("reload")}catch(e){console.log(e)}}),schemas:m,register:a,title:n}}}),V={class:"mt-3"};function ee(c,b,n,g,p,d){const r=C("BasicForm"),m=C("BasicModal");return W(),z(m,Q(c.$attrs,{destroyOnClose:"",onRegister:c.register,title:c.title,onOk:c.handleSubmit}),{default:H(()=>[K("div",V,[L(r,{schemas:c.schemas,ref:"formElRef",labelWidth:75,showActionButtonGroup:!1},null,8,["schemas"])])]),_:1},16,["onRegister","title","onOk"])}var Ae=q(Z,[["render",ee]]);export{Ae as default};
